<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>生日倒计时 · 梦幻紫色星空</title>
  <style>
    html,body{height:100%;margin:0;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans SC', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;}
    body{
      overflow:hidden;
      background: radial-gradient(ellipse at bottom, #1b0a2b 0%, #0b0410 40%, #050209 100%);
      color:#f6eefc;
    }
    canvas{position:fixed;inset:0;display:block;z-index:0}
    .ui{
      position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;padding:20px;text-align:center;
      pointer-events:none; /* let clicks pass to page if needed */
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.06);
      backdrop-filter: blur(6px) saturate(120%);
      padding:18px 28px;border-radius:14px;box-shadow:0 10px 30px rgba(8,4,16,0.6);
      max-width:860px;pointer-events:auto;
    }
    h1{margin:0 0 8px;font-size:28px;letter-spacing:1px;color:#f9f0ff}
    .subtitle{margin:0 0 14px;color:#d9c9f0;opacity:0.95}
    .countdown{font-weight:700;font-size:20px;background:linear-gradient(90deg,#eecbff,#bfa0ff);-webkit-background-clip:text;background-clip:text;color:transparent}
    .small{font-size:13px;color:#cbbfe6;margin-top:8px}
    .btns{margin-top:12px}
    .btn{display:inline-block;padding:8px 14px;border-radius:999px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#f7efff;margin:0 6px;font-size:13px;cursor:pointer}
    .wishes{margin-top:18px;font-size:16px;color:#efe6ff}

    /* 当到达生日后的祝贺大字 */
    .big-toast{
      position:fixed;left:50%;top:20%;transform:translateX(-50%);z-index:3;pointer-events:none;
      text-align:center;font-weight:800;letter-spacing:2px;
      text-shadow:0 6px 30px rgba(120,50,200,0.6), 0 2px 8px rgba(0,0,0,0.6);
      color:#fff;font-size:48px;padding:10px 20px;border-radius:12px;
      display:none;
    }
    .sub-toast{font-size:18px;color:#f5eaff;margin-top:6px}

    @media (max-width:600px){
      h1{font-size:20px}
      .countdown{font-size:16px}
      .card{padding:14px}
      .big-toast{font-size:34px}
    }
  </style>
</head>
<body>
  <canvas id="bg"></canvas>

  <div class="ui">
    <div class="card">
      <h1>梦幻紫色星空 · 生日倒计时</h1>
      <div class="subtitle">为荣荣准备的紫色星海。倒计时会根据本机本地时间自动计算（目标：每年 11 月 27 日 00:00）</div>

      <div class="countdown" id="countdown">--天 --小时 --分 --秒</div>
      <div class="small">到达目标时，会自动触发更多流星与庆祝动画 ✨</div>

      <div class="wishes" id="wishes">偷偷对荣荣说：生日快乐，愿你梦里全是紫色的星辰与温柔。</div>
      <div class="btns">
        <button class="btn" id="toggle-meteor">暂停/继续 流星</button>
        <button class="btn" id="more-meteor">更多流星</button>
      </div>
    </div>
  </div>

  <div class="big-toast" id="bigToast">生日快乐，荣荣！<div class="sub-toast">愿你被世间温柔以待 ♡</div></div>

  <script>
    // Canvas setup
    const canvas = document.getElementById('bg');
    const ctx = canvas.getContext('2d');
    let W = canvas.width = innerWidth;
    let H = canvas.height = innerHeight;

    window.addEventListener('resize', ()=>{W = canvas.width = innerWidth; H = canvas.height = innerHeight; initStars();});

    // Starfield
    let stars = [];
    const STAR_COUNT = Math.floor((W*H)/8000); // density scalable
    function rand(min,max){return Math.random()*(max-min)+min}
    function initStars(){
      stars = [];
      const count = Math.max(80, STAR_COUNT);
      for(let i=0;i<count;i++){
        stars.push({
          x: Math.random()*W,
          y: Math.random()*H,
          r: Math.random()*1.6 + 0.2,
          alpha: Math.random()*0.7 + 0.15,
          twinkle: Math.random()*0.02 + 0.005,
          phase: Math.random()*Math.PI*2
        });
      }
    }

    // Shooting stars (meteors)
    let meteors = [];
    let meteorEnabled = true;
    function spawnMeteor(extra=false){
      if(!meteorEnabled) return;
      const speed = rand(900, 1600) * (extra?1.4:1); // px per second
      const len = rand(120, 340) * (extra?1.4:1);
      // spawn from random upper-left-top-right band
      const fromLeft = Math.random() < 0.6;
      const startX = fromLeft? rand(-W*0.3, W*0.6) : rand(W*0.2, W*1.3);
      const startY = rand(-H*0.2, H*0.4);
      const angle = fromLeft? rand(20, 65) : rand(115, 160); // degrees
      const rad = angle * Math.PI/180;
      meteors.push({x:startX,y:startY, vx: Math.cos(rad)*speed, vy: Math.sin(rad)*speed, len:len, life: rand(0.6,1.6), t:0, glow: rand(0.6,1.0)});
    }

    // background gradient function
    function drawBackground(){
      const grd = ctx.createLinearGradient(0,0,0,H);
      grd.addColorStop(0,'#1b0a2b');
      grd.addColorStop(0.3,'#2a0738');
      grd.addColorStop(0.6,'#15021a');
      grd.addColorStop(1,'#050209');
      ctx.fillStyle = grd;
      ctx.fillRect(0,0,W,H);

      // subtle purple nebula blobs
      const g2 = ctx.createRadialGradient(W*0.85,H*0.15,50,W*0.7,H*0.25,600);
      g2.addColorStop(0,'rgba(180,120,255,0.12)');
      g2.addColorStop(1,'rgba(80,10,80,0)');
      ctx.fillStyle = g2; ctx.fillRect(0,0,W,H);

      const g3 = ctx.createRadialGradient(W*0.25,H*0.7,40,W*0.35,H*0.6,700);
      g3.addColorStop(0,'rgba(200,150,255,0.09)');
      g3.addColorStop(1,'rgba(20,10,20,0)');
      ctx.fillStyle = g3; ctx.fillRect(0,0,W,H);
    }

    // animation loop
    let last = performance.now();
    function animate(now){
      const dt = (now - last)/1000; last = now;
      drawBackground();

      // draw stars
      for(const s of stars){
        s.phase += s.twinkle * dt * 6;
        const a = s.alpha + Math.sin(s.phase)*0.4*s.twinkle*18;
        ctx.beginPath();
        ctx.globalAlpha = Math.max(0, Math.min(1, a));
        ctx.fillStyle = 'rgba(255,255,255,1)';
        ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
        ctx.fill();
      }

      // update meteors
      ctx.globalCompositeOperation = 'lighter';
      for(let i=meteors.length-1;i>=0;i--){
        const m = meteors[i];
        m.t += dt;
        const px = m.x + m.vx * m.t;
        const py = m.y + m.vy * m.t;
        const progress = m.t / m.life;
        if(progress > 1){meteors.splice(i,1); continue}

        // trail
        const tx = px - Math.cos(Math.atan2(m.vy,m.vx))*m.len;
        const ty = py - Math.sin(Math.atan2(m.vy,m.vx))*m.len;

        const grad = ctx.createLinearGradient(px,py,tx,ty);
        grad.addColorStop(0,'rgba(255,255,255,'+ (0.9*m.glow) +')');
        grad.addColorStop(0.5,'rgba(200,150,255,'+ (0.55*m.glow) +')');
        grad.addColorStop(1,'rgba(120,40,160,0)');

        ctx.strokeStyle = grad;
        ctx.lineWidth = 2.2 * (1 - progress) + 0.5;
        ctx.beginPath(); ctx.moveTo(px,py); ctx.lineTo(tx,ty); ctx.stroke();

        // head glow
        ctx.beginPath();
        ctx.fillStyle = 'rgba(255,255,255,'+ (0.9*(1-progress)) +')';
        ctx.arc(px,py,3.6*(1-progress)+1.2,0,Math.PI*2); ctx.fill();

        // subtle sparks
        for(let s=0;s<2;s++){
          const sx = px - Math.random()*m.len*0.5;
          const sy = py - Math.random()*m.len*0.5;
          ctx.fillStyle = 'rgba(200,150,255,'+ (0.15*Math.random()) +')';
          ctx.fillRect(sx,sy,1.5,1.5);
        }
      }
      ctx.globalCompositeOperation = 'source-over';

      // occasionally spawn meteors
      if(Math.random() < 0.016){ // ~1 per 60 frames
        spawnMeteor(false);
      }

      requestAnimationFrame(animate);
    }

    // initial
    initStars();
    // create some initial meteors
    for(let i=0;i<3;i++) setTimeout(()=>spawnMeteor(), i*400);
    requestAnimationFrame(animate);

    // Countdown logic
    const cdEl = document.getElementById('countdown');
    const wishesEl = document.getElementById('wishes');
    const bigToast = document.getElementById('bigToast');

    function getTargetForNow(){
      const now = new Date();
      const year = now.getFullYear();
      let target = new Date(year, 10, 27, 0,0,0,0); // month 10 = Nov
      if(now >= target) target = new Date(year+1,10,27,0,0,0,0);
      return target;
    }

    function updateCountdown(){
      const now = new Date();
      const target = getTargetForNow();
      let diff = Math.floor((target - now)/1000);
      if(diff < 0) diff = 0;
      const days = Math.floor(diff / 86400);
      diff %= 86400;
      const hours = Math.floor(diff/3600);
      diff %= 3600;
      const minutes = Math.floor(diff/60);
      const seconds = diff % 60;
      cdEl.textContent = `${days}天 ${String(hours).padStart(2,'0')}小时 ${String(minutes).padStart(2,'0')}分 ${String(seconds).padStart(2,'0')}秒`;

      if(days===0 && hours===0 && minutes===0 && seconds===0){
        triggerBirthday();
      }
    }
    updateCountdown();
    const cdInterval = setInterval(updateCountdown, 1000);

    // birthday trigger
    let fired = false;
    function triggerBirthday(){
      if(fired) return; fired = true;
      // show big toast
      bigToast.style.display = 'block';
      bigToast.animate([
        { transform: 'translateX(-50%) translateY(-10px)', opacity:0 },
        { transform: 'translateX(-50%) translateY(0)', opacity:1 }
      ], {duration:900, easing:'cubic-bezier(.2,.9,.2,1)', fill:'forwards'});

      // more meteors for celebration
      const burstCount = 20;
      for(let i=0;i<burstCount;i++){
        setTimeout(()=>spawnMeteor(true), i*120);
      }

      // gentle confetti of purple sparkles
      const confetti = setInterval(()=>{
        for(let i=0;i<6;i++) spawnMeteor(true);
      }, 800);

      // after some time, slow it down
      setTimeout(()=>{ clearInterval(confetti); }, 22000);

      // update wishes text
      wishesEl.textContent = '现在，星河为你闪耀。生日快乐！';

      // small pulse on the card
      const card = document.querySelector('.card');
      card.animate([
        { boxShadow: '0 10px 30px rgba(8,4,16,0.6)' },
        { boxShadow: '0 22px 60px rgba(120,50,200,0.45)' },
        { boxShadow: '0 10px 30px rgba(8,4,16,0.6)' }
      ], { duration: 2400, iterations: 3 });
    }

    // controls
    document.getElementById('toggle-meteor').addEventListener('click', ()=>{ meteorEnabled = !meteorEnabled; document.getElementById('toggle-meteor').textContent = meteorEnabled? '暂停/继续 流星' : '暂停/继续 流星'; });
    document.getElementById('more-meteor').addEventListener('click', ()=>{ for(let i=0;i<8;i++) setTimeout(()=>spawnMeteor(true), i*120); });

    // small accessibility: click background to make a meteor
    canvas.addEventListener('click',(e)=>{ spawnMeteor(true); });

    // start an ambient twinkling loop for stars to slowly drift
    setInterval(()=>{
      for(const s of stars){ s.x += (Math.random()-0.5)*6; s.y += (Math.random()-0.5)*2; if(s.x<0) s.x+=W; if(s.x>W) s.x-=W; if(s.y<0) s.y+=H; if(s.y>H) s.y-=H; }
    }, 2200);

  </script>
</body>
</html>
